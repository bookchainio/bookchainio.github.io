<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../shared-styles.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="../../bower_components/marked-element/marked-element.html">


<link rel="import" href="../components/my-icons.html">

<dom-module id="post-card-dialog">
    <template>
        <style include="shared-styles">
            :host {
                width: 100%;
                height: 100%;
                margin: 0;
            }

            paper-dialog {
                padding: 0;
                margin: 0;
                height: 100%;
                width: 100%;
                position: fixed;
            }

            /* HEADER */

            app-header {

                position: fixed;
                top: 0;
                left: 0;
                padding: 0 !important;
                margin: 0 !important;
                width: 100%;
                height: 440px;
                color: #fff;

                background-image: var(--header-background);
                background-position: center;
                background-size: cover;

                --app-header-background-front-layer: {
                    background: -webkit-linear-gradient(top, transparent 0%, transparent 50%, rgba(0,0,0,0.5) 100%);
                };

                --app-header-background-rear-layer: {
                    background-color: var(--app-primary-color);
                };
            }

            paper-icon-button {
                --paper-icon-button-ink-color: white;
            }
            app-toolbar.tall {
                height: 400px;
            }
            sample-content {
                padding-top: 440px;
            }
            [main-title] {
                font-weight: 300;
                position: absolute;
                bottom: 40px;
                left: 180px;
                font-size: 45px;
                margin: 0;
            }
            [condensed-title] {
                font-weight: lighter;
                margin-left: 30px;
                overflow: hidden;
                text-overflow: ellipsis;
                color: var(--app-primary-text-color);
            }
            [condensed-title] i {
                font-weight: 100;
                font-style: normal;
            }

            @media (max-width: 639px) {
                [main-title] {
                    left: 85px;
                }
            }

            /* CONTENT */
            #postContent {
                max-width: 800px;
                padding: 16px;
                margin-left: auto;
                margin-right: auto;
            }

        </style>
        <paper-dialog id="postCardDialog"
                      opened="{{opened}}">
            <app-header condenses fixed
                        effects="waterfall resize-snapped-title fade-background"
                        effects-config='{"resize-snapped-title": {"startsAt": 0.8, "duration": "100ms"}, "fade-background": {"startsAt": 0.8, "endsAt": 0.9}}'>
                <app-toolbar>
                    <paper-icon-button icon="my-icons:close"
                                       id="closeDialogButton"
                                       on-tap="_closeDialog()">
                    </paper-icon-button>
                    <h4 condensed-title>[[post.title]]</h4>
                    <!--paper-icon-button icon="search"></paper-icon-button-->
                </app-toolbar>
                <h1 main-title>[[post.title]]</h1>
            </app-header>
            <div id="postContent">
                <marked-element markdown="[[post.markdownContent]]">
                    <div class="markdown-html"></div>
                </marked-element>
            </div>
        </paper-dialog>
    </template>

    <script>
        Polymer({
            is: 'post-card-dialog',

            properties: {
                opened: {
                    type: Boolean,
                    notify: true
                },
                post: {
                    type: Object,
                    notify: true
                }
            },

            observers: [
                '_updateImageBackground(post.images)'
            ],

            ready: function() {
                this.$.closeDialogButton.addEventListener('tap', this._closeDialog.bind(this));
            },

            _updateImageBackground: function(images) {
                if(typeof images !== 'undefined') {
                    this.customStyle['--header-background'] = 'url('+images[0]+')';
                    this.updateStyles();
                }
            },

            openDialog: function() {
                this.opened = true;
            },

            _closeDialog: function() {
                this.post = {};
                this.opened = false;
            }

        });
    </script>
</dom-module>